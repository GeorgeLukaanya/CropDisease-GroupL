{% extends 'crops/admin/base_admin.html' %}

{% block title %}Analytics - FloraSight Admin{% endblock %}
{% block page_title %}<i class="fas fa-chart-line"></i> Analytics Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1><i class="fas fa-seedling me-2"></i>Agricultural Analytics</h1>
            <p>Comprehensive insights into crop health diagnostics</p>
        </div>
        <div class="header-actions">
            <div class="date-range-picker">
                <i class="fas fa-calendar-alt me-2"></i>
                <span>Last 30 Days</span>
                <i class="fas fa-chevron-down ms-2"></i>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-grid">
        <div class="metric-card primary">
            <div class="metric-icon">
                <i class="fas fa-microscope"></i>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ total_diagnoses }}</div>
                <div class="metric-label">Total Diagnoses</div>
                <div class="metric-trend positive">
                    <i class="fas fa-arrow-up"></i> 12.5% from last month
                </div>
            </div>
            <div class="metric-decoration leaf-1"></div>
        </div>

        <div class="metric-card success">
            <div class="metric-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ completed_diagnoses }}</div>
                <div class="metric-label">Completed</div>
                <div class="metric-trend positive">
                    <i class="fas fa-arrow-up"></i> 8.3% from last month
                </div>
            </div>
            <div class="metric-decoration leaf-2"></div>
        </div>

        <div class="metric-card warning">
            <div class="metric-icon">
                <i class="fas fa-bug"></i>
            </div>
            <div class="metric-content">
                <div class="metric-value">{{ disease_distribution|length }}</div>
                <div class="metric-label">Disease Types</div>
                <div class="metric-trend neutral">
                    <i class="fas fa-equals"></i> No change
                </div>
            </div>
            <div class="metric-decoration leaf-3"></div>
        </div>

        <div class="metric-card info">
            <div class="metric-icon">
                <i class="fas fa-percentage"></i>
            </div>
            <div class="metric-content">
                <div class="metric-value">{% widthratio completed_diagnoses total_diagnoses 100 %}%</div>
                <div class="metric-label">Success Rate</div>
                <div class="metric-trend positive">
                    <i class="fas fa-arrow-up"></i> 2.1% from last month
                </div>
            </div>
            <div class="metric-decoration leaf-4"></div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
        <!-- Monthly Trends -->
        <div class="chart-card large">
            <div class="chart-header">
                <h3><i class="fas fa-chart-line me-2"></i>Monthly Diagnosis Trends</h3>
                <div class="chart-actions">
                    <button class="btn btn-sm btn-outline-success active">Monthly</button>
                    <button class="btn btn-sm btn-outline-success">Weekly</button>
                    <button class="btn btn-sm btn-outline-success">Yearly</button>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="monthlyTrendsChart" height="100"></canvas>
            </div>
        </div>

        <!-- Disease Distribution -->
        <div class="chart-card small">
            <div class="chart-header">
                <h3><i class="fas fa-chart-pie me-2"></i>Disease Distribution</h3>
                <div class="chart-actions">
                    <button class="btn btn-sm btn-outline-warning">View All</button>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="diseaseDistributionChart" height="200"></canvas>
                <div class="chart-center-label">
                    <span class="total-count">{{ total_diagnoses }}</span>
                    <span class="total-label">Total Cases</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Tables Row -->
    <div class="tables-row">
        <!-- Top Diseases -->
        <div class="table-card">
            <div class="table-header">
                <h3><i class="fas fa-virus me-2"></i>Most Common Diseases</h3>
                <div class="table-actions">
                    <button class="btn btn-sm btn-outline-danger">Export</button>
                </div>
            </div>
            <div class="table-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Disease</th>
                                <th>Cases</th>
                                <th>Prevalence</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for disease in disease_distribution|slice:":10" %}
                            <tr>
                                <td>
                                    <div class="disease-info">
                                        <div class="disease-color" style="background-color: {{ disease.color }}"></div>
                                        <span>{{ disease.predicted_disease__name }}</span>
                                    </div>
                                </td>
                                <td>{{ disease.count }}</td>
                                <td>
                                    <div class="progress-container">
                                        {% widthratio disease.count total_diagnoses 100 as percent %}
                                        <div class="progress-value">{{ percent }}%</div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{ percent }}%; background-color: {{ disease.color }}"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center py-4">
                                    <i class="fas fa-database fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">No disease data available</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- System Performance -->
        <div class="stats-card">
            <div class="stats-header">
                <h3><i class="fas fa-tachometer-alt me-2"></i>System Performance</h3>
            </div>
            <div class="stats-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">{{ completed_diagnoses }}</div>
                            <div class="stat-label">Successful</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">{{ total_diagnoses|add:"-"|add:completed_diagnoses }}</div>
                            <div class="stat-label">Processing/Failed</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon primary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">{{ avg_confidence }}%</div>
                            <div class="stat-label">Avg Confidence</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon info">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">{% widthratio completed_diagnoses total_diagnoses 100 %}%</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-chart">
                    <canvas id="performanceChart" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden JSON Data -->
<div id="monthly-data" style="display: none;">{{ monthly_data_json|safe }}</div>
<div id="disease-data" style="display: none;">{{ disease_data_json|safe }}</div>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #2E7D32;
        --primary-light: #4CAF50;
        --secondary: #FFC107;
        --tertiary: #2196F3;
        --dark: #1B5E20;
        --light: #E8F5E9;
        --success: #4CAF50;
        --warning: #FFC107;
        --danger: #F44336;
        --info: #2196F3;
        
        --border-radius: 12px;
        --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* Dashboard Container */
    .dashboard-container {
        padding: 2rem;
        background-color: #f8f9fa;
    }

    /* Dashboard Header */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .header-content h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .header-content p {
        color: var(--text-muted);
        margin-bottom: 0;
    }

    .date-range-picker {
        background-color: white;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        display: flex;
        align-items: center;
        cursor: pointer;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
    }

    .date-range-picker:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .metric-card {
        background-color: white;
        border-radius: var(--border-radius);
        padding: 1.5rem;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .metric-card.primary {
        border-left: 4px solid var(--primary);
    }

    .metric-card.success {
        border-left: 4px solid var(--success);
    }

    .metric-card.warning {
        border-left: 4px solid var(--warning);
    }

    .metric-card.info {
        border-left: 4px solid var(--info);
    }

    .metric-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        font-size: 1.25rem;
    }

    .metric-card.primary .metric-icon {
        background-color: rgba(46, 125, 50, 0.1);
        color: var(--primary);
    }

    .metric-card.success .metric-icon {
        background-color: rgba(76, 175, 80, 0.1);
        color: var(--success);
    }

    .metric-card.warning .metric-icon {
        background-color: rgba(255, 193, 7, 0.1);
        color: var(--warning);
    }

    .metric-card.info .metric-icon {
        background-color: rgba(33, 150, 243, 0.1);
        color: var(--info);
    }

    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .metric-card.primary .metric-value {
        color: var(--primary);
    }

    .metric-card.success .metric-value {
        color: var(--success);
    }

    .metric-card.warning .metric-value {
        color: var(--warning);
    }

    .metric-card.info .metric-value {
        color: var(--info);
    }

    .metric-label {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .metric-trend {
        font-size: 0.75rem;
        display: flex;
        align-items: center;
    }

    .metric-trend.positive {
        color: var(--success);
    }

    .metric-trend.negative {
        color: var(--danger);
    }

    .metric-trend.neutral {
        color: var(--warning);
    }

    .metric-trend i {
        margin-right: 0.25rem;
    }

    .metric-decoration {
        position: absolute;
        opacity: 0.05;
        pointer-events: none;
    }

    .leaf-1 {
        top: -20px;
        right: -20px;
        width: 100px;
        height: 100px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232E7D32'%3E%3Cpath d='M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22L6.66 19.7C7.14 19.87 7.64 20 8 20C19 20 22 3 22 3C21 5 14 5.25 9 6.25C4 7.25 2 11.5 2 13.5C2 15.5 3.75 17.25 3.75 17.25C7 8 17 8 17 8Z' /%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: contain;
    }

    .leaf-2 {
        bottom: -10px;
        right: 10px;
        width: 80px;
        height: 80px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234CAF50'%3E%3Cpath d='M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22L6.66 19.7C7.14 19.87 7.64 20 8 20C19 20 22 3 22 3C21 5 14 5.25 9 6.25C4 7.25 2 11.5 2 13.5C2 15.5 3.75 17.25 3.75 17.25C7 8 17 8 17 8Z' /%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: contain;
        transform: rotate(30deg);
    }

    .leaf-3 {
        top: 10px;
        left: -10px;
        width: 70px;
        height: 70px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FFC107'%3E%3Cpath d='M12 3C13.1 3 14 3.9 14 5S13.1 7 12 7 10 6.1 10 5 10.9 3 12 3M12 17C13.1 17 14 17.9 14 19S13.1 21 12 21 10 20.1 10 19 10.9 17 12 17M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10Z' /%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: contain;
        transform: rotate(-15deg);
    }

    .leaf-4 {
        bottom: -15px;
        left: -15px;
        width: 90px;
        height: 90px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232196F3'%3E%3Cpath d='M12 3C13.1 3 14 3.9 14 5S13.1 7 12 7 10 6.1 10 5 10.9 3 12 3M12 17C13.1 17 14 17.9 14 19S13.1 21 12 21 10 20.1 10 19 10.9 17 12 17M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10Z' /%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: contain;
        transform: rotate(45deg);
    }

    /* Charts Row */
    .charts-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (max-width: 992px) {
        .charts-row {
            grid-template-columns: 1fr;
        }
    }

    /* Chart Cards */
    .chart-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
    }

    .chart-card.large {
        grid-column: span 1;
    }

    .chart-card.small {
        grid-column: span 1;
    }

    .chart-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .chart-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .chart-header h3 i {
        margin-right: 0.75rem;
    }

    .chart-actions .btn {
        margin-left: 0.5rem;
    }

    .chart-body {
        padding: 1.5rem;
        position: relative;
    }

    .chart-center-label {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .total-count {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--dark);
        display: block;
        line-height: 1;
    }

    .total-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Tables Row */
    .tables-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }

    @media (max-width: 768px) {
        .tables-row {
            grid-template-columns: 1fr;
        }
    }

    /* Table Card */
    .table-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
    }

    .table-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .table-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .table-header h3 i {
        margin-right: 0.75rem;
    }

    .table-actions .btn {
        margin-left: 0.5rem;
    }

    .table-body {
        padding: 1.5rem;
    }

    .table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .table thead th {
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 0.75rem 1rem;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        color: var(--text-muted);
    }

    .table tbody tr {
        transition: var(--transition);
    }

    .table tbody tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
    }

    .table tbody td {
        padding: 1rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .disease-info {
        display: flex;
        align-items: center;
    }

    .disease-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        margin-right: 0.75rem;
    }

    .progress-container {
        display: flex;
        align-items: center;
    }

    .progress-value {
        width: 40px;
        font-size: 0.75rem;
        font-weight: 500;
        color: var(--text-muted);
    }

    .progress-bar {
        flex: 1;
        height: 6px;
        background-color: rgba(0, 0, 0, 0.05);
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        border-radius: 3px;
    }

    /* Stats Card */
    .stats-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
    }

    .stats-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .stats-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .stats-header h3 i {
        margin-right: 0.75rem;
    }

    .stats-body {
        padding: 1.5rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .stat-item {
        display: flex;
        align-items: center;
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
    }

    .stat-icon.success {
        background-color: rgba(76, 175, 80, 0.1);
        color: var(--success);
    }

    .stat-icon.warning {
        background-color: rgba(255, 193, 7, 0.1);
        color: var(--warning);
    }

    .stat-icon.primary {
        background-color: rgba(46, 125, 50, 0.1);
        color: var(--primary);
    }

    .stat-icon.info {
        background-color: rgba(33, 150, 243, 0.1);
        color: var(--info);
    }

    .stat-value {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.1rem;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .performance-chart {
        height: 150px;
        margin-top: 1rem;
    }

    /* Empty States */
    .empty-state {
        text-align: center;
        padding: 2rem;
    }

    .empty-state i {
        font-size: 2rem;
        color: var(--text-muted);
        opacity: 0.5;
        margin-bottom: 1rem;
    }

    .empty-state p {
        color: var(--text-muted);
        margin: 0;
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .dashboard-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-actions {
            margin-top: 1rem;
            width: 100%;
        }
        
        .date-range-picker {
            width: 100%;
            justify-content: center;
        }
        
        .metrics-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 576px) {
        .metrics-grid {
            grid-template-columns: 1fr;
        }
        
        .charts-row {
            grid-template-columns: 1fr;
        }
        
        .tables-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Monthly Trends Chart
    const monthlyCtx = document.getElementById('monthlyTrendsChart');
    if (monthlyCtx) {
        const monthlyData = JSON.parse(document.getElementById('monthly-data').textContent);
        
        new Chart(monthlyCtx, {
            type: 'line',
            data: {
                labels: monthlyData.map(item => item.month),
                datasets: [{
                    label: 'Diagnoses',
                    data: monthlyData.map(item => item.count),
                    borderColor: '#2E7D32',
                    backgroundColor: 'rgba(46, 125, 50, 0.05)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2E7D32',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        titleFont: { size: 14 },
                        bodyFont: { size: 12 },
                        padding: 12,
                        cornerRadius: 4
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            padding: 10
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            padding: 10
                        }
                    }
                },
                elements: {
                    line: {
                        borderWidth: 2
                    }
                }
            }
        });
    }

    // Disease Distribution Chart
    const diseaseCtx = document.getElementById('diseaseDistributionChart');
    if (diseaseCtx) {
        const diseaseData = JSON.parse(document.getElementById('disease-data').textContent);
        
        // Generate distinct colors for each disease
        const diseaseColors = [
            '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', 
            '#FF9800', '#FF5722', '#F44336', '#9C27B0',
            '#673AB7', '#3F51B5', '#2196F3', '#03A9F4',
            '#00BCD4', '#009688'
        ];
        
        // Assign colors to diseases for table display
        diseaseData.forEach((item, index) => {
            item.color = diseaseColors[index % diseaseColors.length];
        });
        
        new Chart(diseaseCtx, {
            type: 'doughnut',
            data: {
                labels: diseaseData.slice(0, 6).map(item => item.predicted_disease__name),
                datasets: [{
                    data: diseaseData.slice(0, 6).map(item => item.count),
                    backgroundColor: diseaseColors.slice(0, 6),
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        bodyFont: { size: 12 },
                        padding: 12,
                        cornerRadius: 4,
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    }

    // Performance Chart
    const performanceCtx = document.getElementById('performanceChart');
    if (performanceCtx) {
        new Chart(performanceCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Success Rate',
                    data: [85, 78, 90, 88, 92, 95],
                    backgroundColor: 'rgba(76, 175, 80, 0.7)',
                    borderColor: '#4CAF50',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        bodyFont: { size: 12 },
                        padding: 12,
                        cornerRadius: 4
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });
    }
    
    // Animate elements on scroll
    const animateOnScroll = function() {
        const elements = document.querySelectorAll('.metric-card, .chart-card, .table-card, .stats-card');
        elements.forEach((element, index) => {
            const elementPosition = element.getBoundingClientRect().top;
            const screenPosition = window.innerHeight / 1.3;
            
            if (elementPosition < screenPosition) {
                element.style.animation = `fadeIn 0.5s ease forwards ${index * 0.1}s`;
            }
        });
    };
    
    window.addEventListener('scroll', animateOnScroll);
    animateOnScroll(); // Initialize
});
</script>
{% endblock %}